"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const client_s3_1 = require("@aws-sdk/client-s3");
const Replicate = require("replicate");
const index_js_1 = require("./utils/index.js");
const uuid_1 = require("uuid");
const client_dynamodb_1 = require("@aws-sdk/client-dynamodb");
const style_js_1 = require("./types/style.js");
const replicate = new Replicate();
const s3Client = new client_s3_1.S3Client();
const dydbClient = new client_dynamodb_1.DynamoDBClient({});
const handler = async (event) => {
    const prompt = event.queryStringParameters?.prompt || undefined;
    const style = event.queryStringParameters?.style || undefined;
    if (prompt)
        return handleImageGeneration(prompt, style);
    else
        return (0, index_js_1.LambdaResponse)(400, index_js_1.MISSING_PROMPT_ERROR);
};
exports.handler = handler;
const handleImageGeneration = async (prompt, style) => {
    try {
        if (style) {
            if (Object.values(style_js_1.IStyle).includes(style)) {
                const styleDescription = style_js_1.styleMap.get(style);
                prompt = styleDescription + " " + prompt;
            }
        }
        const response = await generateImage(prompt);
        const imageBuffer = await fetchImage(response[0]);
        const imageId = await saveImageToS3Bucket(imageBuffer);
        await saveImageDataToDynamoDB(imageId, prompt);
        return (0, index_js_1.LambdaResponse)(200, "data:image/jpeg;base64," + imageBuffer.toString("base64"));
    }
    catch (error) {
        return (0, index_js_1.LambdaResponse)(500, error.message);
    }
};
const generateImage = async (prompt) => {
    try {
        const response = await replicate.run("bytedance/sdxl-lightning-4step:727e49a643e999d602a896c774a0658ffefea21465756a6ce24b7ea4165eba6a", {
            input: {
                steps: 20,
                width: 1024,
                height: 1024,
                prompt: prompt,
                output_format: "png",
                output_quality: 100,
                number_of_images: 1,
            },
        });
        return response;
    }
    catch (error) {
        throw new Error(index_js_1.IMAGE_GENERATION_ERROR + error.message);
    }
};
const fetchImage = async (url) => {
    try {
        const response = await fetch(url);
        return Buffer.from(await response.arrayBuffer());
    }
    catch (error) {
        throw new Error(index_js_1.IMAGE_FETCHING_ERROR);
    }
};
const saveImageToS3Bucket = async (imageBuffer) => {
    try {
        const imageId = (0, uuid_1.v4)();
        await s3Client.send(new client_s3_1.PutObjectCommand({
            Bucket: process.env.BUCKET_NAME,
            Key: `${imageId}.png`,
            Body: imageBuffer,
            ContentType: "image/png",
        }));
        return imageId;
    }
    catch (error) {
        throw new Error(index_js_1.S3_BUCKET_SAVE_IMAGE_ERROR);
    }
};
const saveImageDataToDynamoDB = async (imageId, prompt) => {
    try {
        const imageLink = `https://${process.env.BUCKET_NAME}.s3.${process.env.AWS_REGION}.amazonaws.com/${imageId}.png${process.env.DYNAMODB_TABLE_NAME}`;
        const data = {
            TableName: process.env.DYNAMO_DB_TABLE_NAME,
            Item: {
                id: { S: imageId },
                prompt: { S: prompt },
                buyCounter: { N: "0" },
                favoriteCounter: { N: "0" },
                createdAt: { N: Date.now().toString() },
            },
        };
        await dydbClient.send(new client_dynamodb_1.PutItemCommand(data));
    }
    catch (error) {
        throw new Error(index_js_1.DYNAMO_DB_SAVE_IMAGE_DATA_ERROR);
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJnZW5lcmF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxrREFBZ0U7QUFDaEUsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQ3ZDLCtDQU8wQjtBQUUxQiwrQkFBb0M7QUFDcEMsOERBQTBFO0FBQzFFLCtDQUFvRDtBQUVwRCxNQUFNLFNBQVMsR0FBRyxJQUFJLFNBQVMsRUFBRSxDQUFDO0FBQ2xDLE1BQU0sUUFBUSxHQUFHLElBQUksb0JBQVEsRUFBRSxDQUFDO0FBQ2hDLE1BQU0sVUFBVSxHQUFHLElBQUksZ0NBQWMsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUVuQyxNQUFNLE9BQU8sR0FBRyxLQUFLLEVBQUUsS0FBMkIsRUFBRSxFQUFFO0lBQzNELE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxNQUFNLElBQUksU0FBUyxDQUFDO0lBQ2hFLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxLQUFLLElBQUksU0FBUyxDQUFDO0lBRTlELElBQUksTUFBTTtRQUFFLE9BQU8scUJBQXFCLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDOztRQUNuRCxPQUFPLElBQUEseUJBQWMsRUFBQyxHQUFHLEVBQUUsK0JBQW9CLENBQUMsQ0FBQztBQUN4RCxDQUFDLENBQUM7QUFOVyxRQUFBLE9BQU8sV0FNbEI7QUFDRixNQUFNLHFCQUFxQixHQUFHLEtBQUssRUFBRSxNQUFjLEVBQUUsS0FBYyxFQUFFLEVBQUU7SUFDckUsSUFBSSxDQUFDO1FBQ0gsSUFBSSxLQUFLLEVBQUUsQ0FBQztZQUNWLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxpQkFBTSxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQWUsQ0FBQyxFQUFFLENBQUM7Z0JBQ3BELE1BQU0sZ0JBQWdCLEdBQUcsbUJBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxD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QUMsVUFBVSxrQkFBa0IsT0FBTyxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUNuSixNQUFNLElBQUksR0FBRztZQUNYLFNBQVMsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQjtZQUMzQyxJQUFJLEVBQUU7Z0JBQ0osRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRTtnQkFDbEIsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRTtnQkFDckIsVUFBVSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRTtnQkFDdEIsZUFBZSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRTtnQkFDM0IsU0FBUyxFQUFFLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxRQUFRLEVBQUUsRUFBRTthQUN4QztTQUNGLENBQUM7UUFFRixNQUFNLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxnQ0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixNQUFNLElBQUksS0FBSyxDQUFDLDBDQUErQixDQUFDLENBQUM7SUFDbkQsQ0FBQztBQUNILENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFB1dE9iamVjdENvbW1hbmQsIFMzQ2xpZW50IH0gZnJvbSBcIkBhd3Mtc2RrL2NsaWVudC1zM1wiO1xyXG5jb25zdCBSZXBsaWNhdGUgPSByZXF1aXJlKFwicmVwbGljYXRlXCIpO1xyXG5pbXBvcnQge1xyXG4gIERZTkFNT19EQl9TQVZFX0lNQUdFX0RBVEFfRVJST1IsXHJcbiAgSU1BR0VfRkVUQ0hJTkdfRVJST1IsXHJcbiAgSU1BR0VfR0VORVJBVElPTl9FUlJPUixcclxuICBMYW1iZGFSZXNwb25zZSxcclxuICBNSVNTSU5HX1BST01QVF9FUlJPUixcclxuICBTM19CVUNLRVRfU0FWRV9JTUFHRV9FUlJPUixcclxufSBmcm9tIFwiLi91dGlscy9pbmRleC5qc1wiO1xyXG5pbXBvcnQgeyBBUElHYXRld2F5UHJveHlFdmVudCB9IGZyb20gXCJhd3MtbGFtYmRhXCI7XHJcbmltcG9ydCB7IHY0IGFzIHV1aWR2NCB9IGZyb20gXCJ1dWlkXCI7XHJcbmltcG9ydCB7IER5bmFtb0RCQ2xpZW50LCBQdXRJdGVtQ29tbWFuZCB9IGZyb20gXCJAYXdzLXNkay9jbGllbnQtZHluYW1vZGJcIjtcclxuaW1wb3J0IHsgSVN0eWxlLCBzdHlsZU1hcCB9IGZyb20gXCIuL3R5cGVzL3N0eWxlLmpzXCI7XHJcblxyXG5jb25zdCByZXBsaWNhdGUgPSBuZXcgUmVwbGljYXRlKCk7XHJcbmNvbnN0IHMzQ2xpZW50ID0gbmV3IFMzQ2xpZW50KCk7XHJcbmNvbnN0IGR5ZGJDbGllbnQgPSBuZXcgRHluYW1vREJDbGllbnQoe30pO1xyXG5cclxuZXhwb3J0IGNvbnN0IGhhbmRsZXIgPSBhc3luYyAoZXZlbnQ6IEFQSUdhdGV3YXlQcm94eUV2ZW50KSA9PiB7XHJcbiAgY29uc3QgcHJvbXB0ID0gZXZlbnQucXVlcnlTdHJpbmdQYXJhbWV0ZXJzPy5wcm9tcHQgfHwgdW5kZWZpbmVkO1xyXG4gIGNvbnN0IHN0eWxlID0gZXZlbnQucXVlcnlTdHJpbmdQYXJhbWV0ZXJzPy5zdHlsZSB8fCB1bmRlZmluZWQ7XHJcblxyXG4gIGlmIChwcm9tcHQpIHJldHVybiBoYW5kbGVJbWFnZUdlbmVyYXRpb24ocHJvbXB0LCBzdHlsZSk7XHJcbiAgZWxzZSByZXR1cm4gTGFtYmRhUmVzcG9uc2UoNDAwLCBNSVNTSU5HX1BST01QVF9FUlJPUik7XHJcbn07XHJcbmNvbnN0IGhhbmRsZUltYWdlR2VuZXJhdGlvbiA9IGFzeW5jIChwcm9tcHQ6IHN0cmluZywgc3R5bGU/OiBzdHJpbmcpID0+IHtcclxuICB0cnkge1xyXG4gICAgaWYgKHN0eWxlKSB7XHJcbiAgICAgIGlmIChPYmplY3QudmFsdWVzKElTdHlsZSkuaW5jbHVkZXMoc3R5bGUgYXMgSVN0eWxlKSkge1xyXG4gICAgICAgIGNvbnN0IHN0eWxlRGVzY3JpcHRpb24gPSBzdHlsZU1hcC5nZXQoc3R5bGUpO1xyXG4gICAgICAgIHByb21wdCA9IHN0eWxlRGVzY3JpcHRpb24gKyBcIiBcIiArIHByb21wdDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZW5lcmF0ZUltYWdlKHByb21wdCk7XHJcbiAgICBjb25zdCBpbWFnZUJ1ZmZlciA9IGF3YWl0IGZldGNoSW1hZ2UocmVzcG9uc2VbMF0pO1xyXG4gICAgY29uc3QgaW1hZ2VJZCA9IGF3YWl0IHNhdmVJbWFnZVRvUzNCdWNrZXQoaW1hZ2VCdWZmZXIpO1xyXG4gICAgYXdhaXQgc2F2ZUltYWdlRGF0YVRvRHluYW1vREIoaW1hZ2VJZCwgcHJvbXB0KTtcclxuXHJcbiAgICByZXR1cm4gTGFtYmRhUmVzcG9uc2UoXHJcbiAgICAgIDIwMCxcclxuICAgICAgXCJkYXRhOmltYWdlL2pwZWc7YmFzZTY0LFwiICsgaW1hZ2VCdWZmZXIudG9TdHJpbmcoXCJiYXNlNjRcIilcclxuICAgICk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBMYW1iZGFSZXNwb25zZSg1MDAsIChlcnJvciBhcyBFcnJvcikubWVzc2FnZSk7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgZ2VuZXJhdGVJbWFnZSA9IGFzeW5jIChwcm9tcHQ6IHN0cmluZykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcGxpY2F0ZS5ydW4oXHJcbiAgICAgIFwiYnl0ZWRhbmNlL3NkeGwtbGlnaHRuaW5nLTRzdGVwOjcyN2U0OWE2NDNlOTk5ZDYwMmE4OTZjNzc0YTA2NThmZmVmZWEyMTQ2NTc1NmE2Y2UyNGI3ZWE0MTY1ZWJhNmFcIixcclxuICAgICAge1xyXG4gICAgICAgIGlucHV0OiB7XHJcbiAgICAgICAgICBzdGVwczogMjAsXHJcbiAgICAgICAgICB3aWR0aDogMTAyNCxcclxuICAgICAgICAgIGhlaWdodDogMTAyNCxcclxuICAgICAgICAgIHByb21wdDogcHJvbXB0LFxyXG4gICAgICAgICAgb3V0cHV0X2Zvcm1hdDogXCJwbmdcIixcclxuICAgICAgICAgIG91dHB1dF9xdWFsaXR5OiAxMDAsXHJcbiAgICAgICAgICBudW1iZXJfb2ZfaW1hZ2VzOiAxLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoSU1BR0VfR0VORVJBVElPTl9FUlJPUiArIChlcnJvciBhcyBFcnJvcikubWVzc2FnZSk7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgZmV0Y2hJbWFnZSA9IGFzeW5jICh1cmw6IHN0cmluZyk6IFByb21pc2U8QnVmZmVyPiA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsKTtcclxuXHJcbiAgICByZXR1cm4gQnVmZmVyLmZyb20oYXdhaXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihJTUFHRV9GRVRDSElOR19FUlJPUik7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3Qgc2F2ZUltYWdlVG9TM0J1Y2tldCA9IGFzeW5jIChpbWFnZUJ1ZmZlcjogQnVmZmVyKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgaW1hZ2VJZCA9IHV1aWR2NCgpO1xyXG5cclxuICAgIGF3YWl0IHMzQ2xpZW50LnNlbmQoXHJcbiAgICAgIG5ldyBQdXRPYmplY3RDb21tYW5kKHtcclxuICAgICAgICBCdWNrZXQ6IHByb2Nlc3MuZW52LkJVQ0tFVF9OQU1FLFxyXG4gICAgICAgIEtleTogYCR7aW1hZ2VJZH0ucG5nYCxcclxuICAgICAgICBCb2R5OiBpbWFnZUJ1ZmZlcixcclxuICAgICAgICBDb250ZW50VHlwZTogXCJpbWFnZS9wbmdcIixcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIGltYWdlSWQ7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihTM19CVUNLRVRfU0FWRV9JTUFHRV9FUlJPUik7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3Qgc2F2ZUltYWdlRGF0YVRvRHluYW1vREIgPSBhc3luYyAoaW1hZ2VJZDogc3RyaW5nLCBwcm9tcHQ6IHN0cmluZykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBpbWFnZUxpbmsgPSBgaHR0cHM6Ly8ke3Byb2Nlc3MuZW52LkJVQ0tFVF9OQU1FfS5zMy4ke3Byb2Nlc3MuZW52LkFXU19SRUdJT059LmFtYXpvbmF3cy5jb20vJHtpbWFnZUlkfS5wbmcke3Byb2Nlc3MuZW52LkRZTkFNT0RCX1RBQkxFX05BTUV9YDtcclxuICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgIFRhYmxlTmFtZTogcHJvY2Vzcy5lbnYuRFlOQU1PX0RCX1RBQkxFX05BTUUsXHJcbiAgICAgIEl0ZW06IHtcclxuICAgICAgICBpZDogeyBTOiBpbWFnZUlkIH0sXHJcbiAgICAgICAgcHJvbXB0OiB7IFM6IHByb21wdCB9LFxyXG4gICAgICAgIGJ1eUNvdW50ZXI6IHsgTjogXCIwXCIgfSxcclxuICAgICAgICBmYXZvcml0ZUNvdW50ZXI6IHsgTjogXCIwXCIgfSxcclxuICAgICAgICBjcmVhdGVkQXQ6IHsgTjogRGF0ZS5ub3coKS50b1N0cmluZygpIH0sXHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG5cclxuICAgIGF3YWl0IGR5ZGJDbGllbnQuc2VuZChuZXcgUHV0SXRlbUNvbW1hbmQoZGF0YSkpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoRFlOQU1PX0RCX1NBVkVfSU1BR0VfREFUQV9FUlJPUik7XHJcbiAgfVxyXG59O1xyXG4iXX0=